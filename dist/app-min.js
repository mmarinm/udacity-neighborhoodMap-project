"use strict";function initMap(){getYelpData();var e={lat:40.7634,lng:-73.919};map=new google.maps.Map(document.getElementById("map"),{center:e,styles:styles,mapTypeControl:!1,zoom:14}),infowindow=new google.maps.InfoWindow}function createMarker(e){var t=new google.maps.LatLng(e.lat,e.long),i=new google.maps.Marker({map:map,position:t});return i}var bizList=ko.observableArray([]),map,infowindow,styles=[{featureType:"water",stylers:[{color:"#19a0d8"}]},{featureType:"administrative",elementType:"labels.text.stroke",stylers:[{color:"#ffffff"},{weight:6}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{color:"#e85113"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#efe9e4"},{lightness:-40}]},{featureType:"transit.station",stylers:[{weight:9},{hue:"#e85113"}]},{featureType:"road.highway",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"labels.text.stroke",stylers:[{lightness:100}]},{featureType:"water",elementType:"labels.text.fill",stylers:[{lightness:-100}]},{featureType:"poi",elementType:"geometry",stylers:[{visibility:"on"},{color:"#f0e4d3"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#efe9e4"},{lightness:-25}]}],Restaurant=function(e){this.name=ko.observable(e.name),this.rating_img=e.rating_img_url_small,this.rating=e.rating,this.categorie=e.categories[0][0],this.address=e.location.address,this.postal_code=e.location.postal_code,this.city=e.location.city,this.phone=e.phone,this.url=e.url,this.lat=e.location.coordinate.latitude,this.long=e.location.coordinate.longitude,this.marker=createMarker(this)},getYelpData=function(){var e="GET",t="https://api.yelp.com/v2/search/",i=function(e){for(var t="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a=0;a<e;a++)t+=i.charAt(Math.floor(Math.random()*i.length));return t},a={oauth_consumer_key:"b8gVZVpLRVnCU-vJ5EKQjg",oauth_token:"5ON_d5tuD3z-AD9aOp06I3caRGuHURnW",oauth_nonce:i(20),oauth_timestamp:Math.floor(Date.now()/1e3),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",callback:"cb",term:"restaurants",location:"Astoria, NY",limit:30},s="CO49QSWhFiUobA5kvevikpdOBDk",o="9gDyJlB6W-TSMarkzCUSW7e89lY",r=oauthSignature.generate(e,t,a,s,o);a.oauth_signature=r;var n={url:t,data:a,cache:!0,dataType:"jsonp",success:function(e){e.businesses.forEach(function(e){bizList.push(new Restaurant(e))})},error:function(){alert("Data could not be retrieved from yelp.")}};$.ajax(n)},viewModel=function(){var e=this;e.currentFilter=ko.observable(""),e.menuIsVisible=ko.observable(!1),e.showInfo=function(e){infowindow.setContent('<div class="gm-style-iw"><div class = "title full-width"><h3 class = "business-title">'+e.name()+'</h3></div><div class ="business-rating"><img src="'+e.rating_img+'"><span> ('+e.rating+')</span></div><div class = "business-type">'+e.categorie+'</div><div class = "address-label label">Address:</div><div class = "business-address">'+e.address+", "+e.postal_code+" "+e.city+'</div><div class = "phone-label label">Phone: </div><div class = "business-phone">'+e.phone+'</div><div class = "business-url"><a target="_blank" href = "'+e.url+'">Find out more</a></div></div>'),infowindow.open(map,e.marker),setTimeout(function(){e.marker.setAnimation(null)},1e3),e.marker.setAnimation(google.maps.Animation.BOUNCE)},e.hideMenu=function(){e.menuIsVisible()===!1?e.menuIsVisible(!0):e.menuIsVisible(!1)},e.filterMarkers=ko.computed(function(){return e.currentFilter()?ko.utils.arrayFilter(bizList(),function(t){if(t.marker.setVisible(!1),t.name().toLowerCase().search(e.currentFilter().toLowerCase())>=0)return t.marker.setVisible(!0),!0}):(bizList().forEach(function(t){t.marker.setVisible(!0),google.maps.event.addListener(t.marker,"click",function(){e.showInfo(t)})}),bizList())})};ko.applyBindings(new viewModel);